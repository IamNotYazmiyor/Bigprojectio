<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Tracking - Görsel Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        /* Kendi görüntünü göreceğin küçük panel */
        #video-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 110px;
            border: 2px solid #00ffcc;
            border-radius: 10px;
            overflow: hidden;
            z-index: 100;
            transform: scaleX(-1); /* Ayna efekti */
        }
        video { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div id="video-container">
    <video id="input_video" playsinline></video>
</div>

<script>
const videoElement = document.getElementById('input_video');
let handLandmarks = [];
let particles = [];

// 1. MediaPipe Ayarları
const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7, // Daha kararlı takip için artırdık
    minTrackingConfidence: 0.7
});

hands.onResults((results) => {
    handLandmarks = results.multiHandLandmarks;
});

// 2. Kamera Başlatma (Ön Kamera Zorlaması)
const camera = new Camera(videoElement, {
    onFrame: async () => {
        await hands.send({image: videoElement});
    },
    width: 640,
    height: 480,
    facingMode: 'user' // Ön kamerayı kullanması için
});
camera.start();

// 3. p5.js Çizim
function setup() {
    let cnv = createCanvas(windowWidth, windowHeight);
    cnv.style('display', 'block');
}

function draw() {
    background(0, 70);

    if (handLandmarks && handLandmarks.length > 0) {
        // Ayna efekti için x koordinatını tersliyoruz
        let finger = handLandmarks[0][8];
        let x = (1 - finger.x) * width; 
        let y = finger.y * height;

        for (let i = 0; i < 5; i++) {
            particles.push(new Particle(x, y));
        }
    }

    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].finished()) {
            particles.splice(i, 1);
        }
    }
}

class Particle {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = random(-3, 3);
        this.vy = random(-3, 3);
        this.alpha = 255;
    }
    finished() { return this.alpha < 0; }
    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= 7;
    }
    show() {
        noStroke();
        fill(0, 255, 204, this.alpha);
        ellipse(this.x, this.y, 10);
    }
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}
</script>
</body>
</html>

